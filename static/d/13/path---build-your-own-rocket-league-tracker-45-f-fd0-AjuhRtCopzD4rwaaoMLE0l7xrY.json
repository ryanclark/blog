{"data":{"site":{"siteMetadata":{"title":"ryanclark.me","author":"Ryan Clark"}},"markdownRemark":{"id":"2afb3ee3-812f-597e-b624-6163fba412c1","excerpt":"The tracking websites available for Rocket League have always interested me, and one weekend I wanted to build my own. However, after a couple of emails and…","html":"<p>The tracking websites available for Rocket League have always interested me, and one weekend I wanted to build my own. However, after a couple of emails and automated replies declining my request to access the (currently) closed tracking API, I figured out how to do it myself. Let’s take a look at creating a tracker for your stats.</p>\n<h2>Reverse Engineering the API</h2>\n<p>In order to know how to communicate with the Rocket League API, I needed to reverse engineer it. </p>\n<p>After a bit of research, I stumbled upon <a href=\"https://github.com/AeonLucid/RocketLeaguePublic\">this repo</a> that has some documentation for the Rocket League API that you use in the background every time that you play the game. This was a great start - it pointed my where to look, as well as giving me the start of the codebase I needed in order to retrieve my own stats or other people’s stats from the API.</p>\n<p>The code in the repo uses the Steam API to login to the Rocket League API. At the time, I only owned the game on PS4 and wanted to be able to sniff the traffic to learn more about the API. This proved impossible as I could not install a custom root certificate onto my PS4 that would allow me to decrypt the traffic proxied through my MacBook.</p>\n<p>A friend of mine owned the game on Xbox One, so I thought about looking into sniffing the traffic on an Xbox instead. I paid for a Xbox developer account as this allows you to sniff traffic on the console. Great! I rebooted their console into developer mode, and then realised you can only run games/apps that you create yourself in the Xbox developer mode. Damn.</p>\n<p>The only option left was to run Rocket League on the only device that I have full control over. Luckily Rocket League runs on macOS, so I didn’t have to find a PC and proxy the traffic through my MacBook - I could just boot up the game on my MacBook, leave it running in the background and inspect the traffic to Rocket League’s servers.</p>\n<p><a href=\"https://github.com/AeonLucid/RocketLeaguePublic#13-intercepting-requests\">As noted here</a> in the repo above, the Rocket League API communicates over a websocket, but fails over to a REST API if the connection to the websocket fails 10 times. They kindly provide a script for <a href=\"https://www.telerik.com/fiddler\">Fiddler</a>, a network traffic sniffing tool, that blocks the connection to the websocket. Fiddler runs on macOS through Mono which kept crashing on me, so I had to use something else.</p>\n<p>Instead, I found <a href=\"https://www.telerik.com/fiddler-everywhere\">Fiddler Everywhere</a>. This is a lightweight, stripped down version of Fiddler that works natively on macOS. This is what I used to sniff the traffic and figure out the API.</p>\n<p>Fiddler Everywhere does not currently support custom scripts, so I had to find a different way to block the connection to the websocket. Let’s look at the traffic and how I sniffed it.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cdeb81b5bc70d5176674d36665b965f7/d3016/initial-request.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 44.337811900191944%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABmElEQVQoz62QTS/EQBjHfQ7fwYoLV3eO4owDi127jk4iNnFyEiIcXHwWDghiQ1bjZXf7tjWzWm2n06nO4+mUEnH0JL/8Mp15/n1mBh6em1uGrm92u91Ny7IapmkqbCv349NTQ9O0hmEYxd5PsG9D1/XtVqs1OZAV/FO12+1jFWjaDnQMM+45jtBNS9hou+eIkwsfHQjGAhGGYUEURYIjmRljArPYVbMF03O1PRXIeQSU0tR1XYkGz3MBG+HsikJHp0D7BFzPgzffVwRBCEGYk60B0uT08hbGJmf2VaCUEnzfTzFEvr66GE6AsQia9wz6Loc4jgCnKWA/yEKxkvMbDcanyvvFGwZBkOLhFC09z5P4AyniEOESv0vO+Z/glSW2i/Pmr0AhBMg0hSRJcCKu1izKnSC//QXncdb+nk04OjF7oAIJIUAo5aTfj18oFQ4hCBWmbSssu5e79+0vTMsW+O7s+k6Dta2dXRU4v1AeXq6ulBYr1dISenmlplyp1UvV+qpypXA99yfZfrlSHVrfWB85OtwdzPI+AFDwSXIg4tByAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Initial Request\"\n        title=\"\"\n        src=\"/static/cdeb81b5bc70d5176674d36665b965f7/6255c/initial-request.png\"\n        srcset=\"/static/cdeb81b5bc70d5176674d36665b965f7/375dc/initial-request.png 148w,\n/static/cdeb81b5bc70d5176674d36665b965f7/6b157/initial-request.png 295w,\n/static/cdeb81b5bc70d5176674d36665b965f7/6255c/initial-request.png 590w,\n/static/cdeb81b5bc70d5176674d36665b965f7/dcf9c/initial-request.png 885w,\n/static/cdeb81b5bc70d5176674d36665b965f7/43c8a/initial-request.png 1180w,\n/static/cdeb81b5bc70d5176674d36665b965f7/dc8c4/initial-request.png 1770w,\n/static/cdeb81b5bc70d5176674d36665b965f7/d3016/initial-request.png 3126w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>After logging in, there is a POST request fired off to <code class=\"language-text\">https://psyonix-rl.appspot.com/Services</code>, hitting the <code class=\"language-text\">Auth/AuthPlayer</code> service. This passes through an <code class=\"language-text\">AppTicket</code> (more on that later), to log the user in.</p>\n<p>The response contains a link to the websocket that the client will use to communicate with Rocket League. As you can see in the screenshot above, the URL to this is <code class=\"language-text\">wss://rl-psy.net/ws?PsyConnectionType=Player</code>. As we can’t sniff the traffic passed through this websocket, we need to block the connection somehow.</p>\n<p>To do this, I simply looped <code class=\"language-text\">rl-psy.net</code> back to <code class=\"language-text\">127.0.0.1</code> in my <code class=\"language-text\">/etc/hosts</code> file. This means all requests to the websocket will fail, resulting in the client falling back to the REST API.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fe7d09ab1a12c607047b2a03f1a1ff30/998d3/hosts.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 60.93457943925233%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACHElEQVQoz62S224SURSGaQIoUOox7QCWlnIYqJYB9sww5xMDCK2laLjxysRLX8MbX8ALO0kfo/g+RhKjMfHCxOKwXHugY6reNHGSL/9a+/DPWnvvSCTvRP7X92wyWUXx++lXjvH65Qv5TH+qnKqK4emm4XV7fe/JaOSNxuOA49GJ13888DTD8AzTwjXmKeoZ6huGyaRDZ2a3WHo+nnxzuw6IugltyQYi6CC0MZYdkJQOyGoH1cExC1q8HkIEA+qN9sXGxu1yaHj3zr26qLgfGi0LCG//EGV3ztbEebHcmu+VmwE0XrKMSxVC9aLEkkWZJZ9uJlKN0DCdvsUJojWznCMwzKEvtB3QjQFW1Q3UsIagaH1Q1B6Y9iHQdZLSBdM69KlWquRLIrneDA2TyXVOkjszOkkEyxelDlDTRkvHll3gRRvbMwOlOf0RnUd8XrCXhonUb0NMOFXrzXRzECzCthZcU1tY9tECq1pUqnwItodKVjnx2ZoAbI2/ahi/keAUrfvRcY9pG3OsxJfVnu/2Tnwco0dAN/rVffEPhJ+owFbJ578qrDfUr01iwgGn4q3RG+6A445AN4eYa7D/SEaklV7GEjw8ULBC4fuVM4zF4oVsbu8t8j6TLZwz2cIUdXqpFJz7F+e5B8Vpbrv0LhqLF5cXkgreYwrJIxzSvCZ0zw71wE7DCteYzE50cysf29zavib5GJPZjWKFa9TrF/TT7DDvN+wHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Hosts File\"\n        title=\"\"\n        src=\"/static/fe7d09ab1a12c607047b2a03f1a1ff30/6255c/hosts.png\"\n        srcset=\"/static/fe7d09ab1a12c607047b2a03f1a1ff30/375dc/hosts.png 148w,\n/static/fe7d09ab1a12c607047b2a03f1a1ff30/6b157/hosts.png 295w,\n/static/fe7d09ab1a12c607047b2a03f1a1ff30/6255c/hosts.png 590w,\n/static/fe7d09ab1a12c607047b2a03f1a1ff30/dcf9c/hosts.png 885w,\n/static/fe7d09ab1a12c607047b2a03f1a1ff30/998d3/hosts.png 1070w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>I restarted Fiddler Everywhere and Rocket League, then waited for the connections to the websocket to fail. Unlike before, this didn’t work - Rocker League must have patched it.</p>\n<p>To get around this, I created my own websocket and hosted it, creating a local certificate for <code class=\"language-text\">rl-psy.net</code> and trusting it in Keychain Access. That way I could look at all the requests being fired off. I tried to then connect to the actual <code class=\"language-text\">rl-psy.net</code> websocket via the IP, so I could effectively create a reverse proxy whilst intercepting the requests and responses. That part didn’t work, so I was only able to intercept requests from the game to the websocket. Fortunately, this was enough to create my own tracker.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> readFileSync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createServer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'https'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> resolve <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'path'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> WebSocket <span class=\"token keyword\">from</span> <span class=\"token string\">'ws'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  key<span class=\"token punctuation\">:</span> <span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'../certs/server.key'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  cert<span class=\"token punctuation\">:</span> <span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'../certs/server.crt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> wss <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebSocket<span class=\"token punctuation\">.</span>Server</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> server <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nwss<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connection'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ws</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">443</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>After launching Rocket League, the requests started to come through. Although I wasn’t able to receive any responses, I could still see the request payloads. For example, to fetch the player’s friends list:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Service\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Friends/GetFriendList\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ID\"</span><span class=\"token operator\">:</span> <span class=\"token number\">140</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Params\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<h2>Sculpting Rocket League API requests</h2>","frontmatter":{"title":"Build your own Rocket League Tracker","warning":"This guide worked at the time of posting. Things might have changed since then.","date":"April 08, 2019"}}},"pageContext":{"slug":"/build-your-own-rocket-league-tracker/","previous":{"fields":{"slug":"/going-native-with-react/"},"frontmatter":{"title":"Going native with React, an introduction"}},"next":null}}