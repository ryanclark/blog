<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700"/><link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/26px 'Open Sans',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Open Sans',sans-serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;}ul{margin-left:1.625rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.625rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;font-size:0.85rem;line-height:1.625rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;font-size:1rem;line-height:1.625rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;}blockquote{margin-left:1.625rem;margin-right:1.625rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.625rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.625rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.625rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.625rem;margin-bottom:calc(1.625rem / 2);margin-top:calc(1.625rem / 2);}li > ul{margin-left:1.625rem;margin-bottom:calc(1.625rem / 2);margin-top:calc(1.625rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.625rem / 2);}code{font-size:0.85rem;line-height:1.625rem;}kbd{font-size:0.85rem;line-height:1.625rem;}samp{font-size:0.85rem;line-height:1.625rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.08333rem;padding-right:1.08333rem;padding-top:0.8125rem;padding-bottom:calc(0.8125rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#007acc;text-decoration:none;}</style><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8b8d709ee1c3500b70b3f9527cc92c77f9778614"/><style data-href="/styles.41553e5c7c3f6fa1f41c.css">.scroll{width:100%;overflow-x:auto}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;font-family:Menlo,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0 1.625rem;overflow:auto;border-radius:.3em;background:#282a36}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#6272a4}.token.punctuation{color:#89ddff}.namespace{opacity:.7}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.inserted,.token.selector{color:#50fa7b}.token.string{color:#c3e88d}.token.attr-name{color:#ffcb6b}.token.tag .token.class-name,.token.tag .token.tag{color:#f07178}.language-css .token.string,.style .token.string,.token.entity,.token.url,.token.variable{color:#f8f8f2}.token.operator{color:#89ddff}.token.atrule,.token.class-name,.token.function{color:#82aaff}.token.attr-value,.token.attr-value .token.punctuation{color:#c3e88d}.token.boolean,.token.keyword{color:#c792ea}.token.important,.token.regex{color:#ffb86c}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}code.language-text{background:rgba(0,0,0,.05);font-family:Menlo,monospace;color:rgba(0,0,0,.8);padding:0 3px;border:1px solid rgba(0,0,0,.1);border-radius:3px}</style><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png?v=8b8d709ee1c3500b70b3f9527cc92c77f9778614"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#2D3C3F"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8b8d709ee1c3500b70b3f9527cc92c77f9778614"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8b8d709ee1c3500b70b3f9527cc92c77f9778614"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8b8d709ee1c3500b70b3f9527cc92c77f9778614"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8b8d709ee1c3500b70b3f9527cc92c77f9778614"/><meta name="generator" content="Gatsby 2.2.3"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8b8d709ee1c3500b70b3f9527cc92c77f9778614"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8b8d709ee1c3500b70b3f9527cc92c77f9778614"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8b8d709ee1c3500b70b3f9527cc92c77f9778614"/><title data-react-helmet="true">Introduction to Facebook&#x27;s Flux architecture | ryanclark.me</title><meta data-react-helmet="true" name="description" content="If you’re like me and you wanted to go further with React, you more than likely would’ve checked out  Flux , had a glance, closed the tab  and then reassessed…"/><meta data-react-helmet="true" property="og:title" content="Introduction to Facebook&#x27;s Flux architecture"/><meta data-react-helmet="true" property="og:description" content="If you’re like me and you wanted to go further with React, you more than likely would’ve checked out  Flux , had a glance, closed the tab  and then reassessed…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Ryan Clark"/><meta data-react-helmet="true" name="twitter:title" content="Introduction to Facebook&#x27;s Flux architecture"/><meta data-react-helmet="true" name="twitter:description" content="If you’re like me and you wanted to go further with React, you more than likely would’ve checked out  Flux , had a glance, closed the tab  and then reassessed…"/><link as="script" rel="preload" href="/component---src-templates-blog-post-tsx-55170dfe89bf8d80733f.js"/><link as="script" rel="preload" href="/9-0c2af406927ebc328aa0.js"/><link as="script" rel="preload" href="/0-598e12153a4b2f19d440.js"/><link as="script" rel="preload" href="/app-6cffb0c4ad93a48e7404.js"/><link as="script" rel="preload" href="/styles-99a47daf12289a4bd376.js"/><link as="script" rel="preload" href="/webpack-runtime-89ac9663dc7ab56cdd13.js"/><link as="fetch" rel="preload" href="/static/d/929/path---getting-started-with-flux-896-542-Nvj4997rMy2eGWfljaABEfppz9E.json" crossorigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><style data-emotion-css="i2srys">.css-i2srys{max-width:1200px;padding-top:50px;margin:0 auto;}</style><div class="css-i2srys e1i1zd320"><style data-emotion-css="cnyx0w">.css-cnyx0w{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}@media (max-width:800px){.css-cnyx0w{padding:0 15px;}}</style><header class="css-cnyx0w e1i1zd323"><style data-emotion-css="zjk0ag">.css-zjk0ag{-webkit-text-decoration:none;text-decoration:none;box-shadow:none;}.css-zjk0ag:hover{-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-zjk0ag e1i1zd321" href="/"><style data-emotion-css="1thzyjp">.css-1thzyjp{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-family:menlo,monospace;font-weight:600;color:#F36964;font-size:28px;position:relative;}</style><div class="css-1thzyjp ehjmckk2"><style data-emotion-css="1tx8c9d">.css-1tx8c9d{color:#56E386;margin-right:14px;}</style><div class="css-1tx8c9d ehjmckk0">➜</div><style data-emotion-css="7slaet">.css-7slaet{color:#93a1a1;margin-right:10px;position:relative;top:-1px;}</style><div class="css-7slaet ehjmckk1">~</div>ryan.clark</div></a><style data-emotion-css="hz653u">.css-hz653u{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-hz653u svg{width:32px;height:32px;}</style><header class="css-hz653u e1i1zd324"><style data-emotion-css="11dpuo7">.css-11dpuo7{margin-left:15px;}.css-11dpuo7 svg{fill:#262626;}</style><a href="https://github.com/ryanclark" target="_blank" class="css-11dpuo7 e1i1zd322"><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0 0 24 24"><g id="surface1"><path d="M 4.0625 4 C 4.0625 4 3.53125 4.925781 3.53125 6.5 C 3.53125 7.546875 3.765625 8.125 3.9375 8.40625 C 2.734375 9.660156 2 11.347656 2 13.53125 C 2 19.125 5.527344 21 12 21 C 18.472656 21 22 19.125 22 13.53125 C 22 11.269531 21.304688 9.574219 20.15625 8.34375 C 20.441406 7.488281 20.769531 5.871094 19.96875 4 C 17.582031 4 15.570313 5.839844 15.5 5.90625 C 14.386719 5.660156 13.210938 5.53125 12 5.53125 C 10.761719 5.53125 9.542969 5.6875 8.40625 5.96875 C 6.808594 4.378906 4.886719 4 4.0625 4 Z M 15.21875 12 C 15.820313 11.992188 16.386719 12.054688 16.875 12.21875 C 18.179688 12.660156 19 13.945313 19 15.375 C 18.996094 19.339844 16.996094 20 11.875 20 C 8.066406 20 4.96875 19.285156 4.96875 15.5 C 4.96875 14.054688 5.71875 13.226563 6.25 12.71875 C 7.417969 11.601563 9.257813 12.15625 11.875 12.15625 C 13.0625 12.15625 14.214844 12.011719 15.21875 12 Z M 8 14 C 7.449219 14 7 14.671875 7 15.5 C 7 16.328125 7.449219 17 8 17 C 8.550781 17 9 16.328125 9 15.5 C 9 14.671875 8.550781 14 8 14 Z M 16 14 C 15.449219 14 15 14.671875 15 15.5 C 15 16.328125 15.449219 17 16 17 C 16.550781 17 17 16.328125 17 15.5 C 17 14.671875 16.550781 14 16 14 Z "></path></g></svg></a><a href="https://twitter.com/rynclark" target="_blank" class="css-11dpuo7 e1i1zd322"><svg viewBox="0 0 48 48" width="1em" height="1em"><g id="surface1"><path fill="#03A9F4;" d="M 42 12.429688 C 40.675781 13.015625 39.253906 13.40625 37.753906 13.589844 C 39.277344 12.683594 40.453125 11.238281 41.003906 9.53125 C 39.574219 10.371094 37.992188 10.984375 36.3125 11.308594 C 34.96875 9.882813 33.050781 9 30.925781 9 C 26.847656 9 23.539063 12.277344 23.539063 16.320313 C 23.539063 16.890625 23.605469 17.449219 23.730469 17.988281 C 17.59375 17.683594 12.148438 14.765625 8.507813 10.335938 C 7.867188 11.417969 7.507813 12.683594 7.507813 14.023438 C 7.507813 16.5625 8.808594 18.800781 10.792969 20.117188 C 9.582031 20.082031 8.441406 19.742188 7.445313 19.203125 C 7.445313 19.226563 7.445313 19.257813 7.445313 19.289063 C 7.445313 22.839844 9.992188 25.796875 13.367188 26.472656 C 12.75 26.640625 12.097656 26.734375 11.425781 26.734375 C 10.949219 26.734375 10.484375 26.679688 10.035156 26.597656 C 10.972656 29.5 13.699219 31.621094 16.933594 31.683594 C 14.402344 33.644531 11.21875 34.820313 7.757813 34.820313 C 7.160156 34.820313 6.574219 34.785156 5.996094 34.714844 C 9.269531 36.785156 13.152344 38 17.320313 38 C 30.90625 38 38.339844 26.84375 38.339844 17.164063 C 38.339844 16.847656 38.328125 16.53125 38.3125 16.222656 C 39.761719 15.195313 41.011719 13.90625 42 12.429688 "></path></g></svg></a></header></header><style data-emotion-css="fltxi7">.css-fltxi7{max-width:800px;margin:100px auto 0;}@media (max-width:800px){.css-fltxi7{margin:20px auto 0;padding:10px 15px;}}</style><main class="css-fltxi7 e1i1zd325"><style data-emotion-css="1myjwgk">.css-1myjwgk{font-family:Oswald,sans-serif;text-transform:uppercase;font-size:100px;max-width:660px;line-height:110px;color:#282A36;margin-bottom:35px;}@media (max-width:800px){.css-1myjwgk{font-size:42px;line-height:48px;}}</style><h1 class="css-1myjwgk e1xte7000">Introduction to Facebook&#x27;s Flux architecture</h1><p style="font-size:0.87055rem;line-height:1.625rem;display:block;margin-bottom:1.625rem;margin-top:-1.625rem">February 21, 2015</p><style data-emotion-css="hhsj82">.css-hhsj82{background:#FEEFB3;border:1px solid rgba(0,0,0,.05);color:rgba(0,0,0,.8);border-radius:3px;margin:10px 0 20px;padding:10px 20px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-hhsj82 svg{width:20px;height:20px;margin-right:10px;fill:rgba(0,0,0,0.8);}</style><div class="css-hhsj82 e1d98fs50">The versions of Flux and React in this article are quite old - some of this may not work</div><div><p>If you’re like me and you wanted to go further with React, you more than likely would’ve checked out <a href="http://facebook.github.io/flux/docs/overview.html#content" target="_blank">Flux</a>, had a glance, closed the tab<!--more--> and then reassessed your life as a Javascript developer.</p>
<p>If you’re not familiar with React, please checkout my <a target="_blank" href="/getting-started-with-react">getting started with React</a> post.</p>
<h2>What the Flux?</h2>
<p>Flux - from a distance - looks complex to get started with. However, if you look at the <a href="https://github.com/facebook/flux/tree/master/examples" target="_blank">examples over on GitHub</a>, it actually starts to become really clear how it all works.</p>
<p>Flux is, on simple terms, a glorified <a href="http://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern" target="_blank">pub/sub</a> architecture. Data flows one way through the system, and is picked up by various subscribers along the way. One simple way to think about this is to refer to our bodies.</p>
<h3>Events - the blood</h3>
<p>Blood travels one way around your body. It gives your organs all the stuff it needs, and picks up more stuff whilst cycling through. All events in Flux travel one way, out of the dispatcher. They may even contain payload data that we need to store.</p>
<h3>Dispatcher - the heart</h3>
<p>You only have one heart at any time in your body (most of the time). This is true with the dispatcher, you should only have one per application. The dispatcher purely dispatches events to be listened for - think of it as a central hub.</p>
<h3>Stores - the organs</h3>
<p>Our organs take our blood and store what it needs out of it (I was never good at science). which is the same with stores in Flux. Stores wait for events to come, and store the appropriate data that it gives us. Each store can watch for different events, as well as multiple stores watching for the one event.</p>
<h3>Actions - the lungs</h3>
<p>This is a bit of a stretch, but much like how our lungs oxygenate our blood and pass it through to the heart to push around, actions allow us to push events into our dispatcher to be broadcasted to the rest of our application.</p>
<h3>View - the body</h3>
<p>Once our organs have got all that they need from the blood, they can then do stuff with it. It’s the same concept with views - once we’ve got all the data we need, we can display it!</p>
<h2>Let’s chat</h2>
<p>Whilst I do apologise for that poor analogy, it does help to simplify what each part of Flux does. We’re going to create a simple messaging app (much like one of the Flux examples on GitHub), with multiple components that rely on staying in sync with each other. You can <a href="https://github.com/ryanclark/flux-getting-started" target="_blank">clone the start repo here</a>, which includes a gulp task for writing our application. Please note, you don’t need to clone the repo - I will link to demos during the tutorial!</p>
<h3>Install</h3>
<p>To get started with the boilerplate, you will need to run</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&amp;&amp;</span> bower <span class="token function">install</span></code></pre></div>
<p>This will install all of our bower components and node modules, including Flux and React for us to get started with. To run the local web server, run</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">gulp</code></pre></div>
<p>And then open up <code class="language-text">http://localhost:4000</code> - simple!</p>
<p>This app uses browserify to build our Javascript files - if you’re unfimilar with browserify, head over to <a href="http://www.sitepoint.com/getting-started-browserify/" target="_blank">this tutorial.</a></p>
<p>Once you’ve opened up localhost, you should be met with our boilerplate React app!</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/fc859eb2a8c33f900342705ad06a3127/f70b8/step-one.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 57.332677165354326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABKElEQVQoz62RQUvDMBiG8xvFq4jgP9htc4OJXvwBspMHmSeV7eChTFi1KE7sRpGBujZ1a9d17cExXbs16fqZ1CJ4chFfeAIvvDwkBF22Hteuu3bjofd21hlManeGwxgJ4NRa2D2/felLp5K0jraqJ7s59R625QvYaXehYsRQwUSIw94cjsYA5ebzPqoeH+RvtDooT/UFdjUKALEgdDonkWJN4NUeFpHWlAs0IDB7jyklkCRssWTnqiQsdJlwMYzccQlZg36Bl1nwQSMScR8fiZBkNwXf80rItoepMAxDSgj5Ifwt2eZb6H0J7T8Ls+3qQtEnp0LLsvK8BEGwYML059hGlCgTFpHjOGX4p/i+v4dUVd3AGHcMw5B1XVc4rCumaYpwxWizbH4CRDctGkLsM5QAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Step One"
        title=""
        src="/static/fc859eb2a8c33f900342705ad06a3127/6255c/step-one.png"
        srcset="/static/fc859eb2a8c33f900342705ad06a3127/375dc/step-one.png 148w,
/static/fc859eb2a8c33f900342705ad06a3127/6b157/step-one.png 295w,
/static/fc859eb2a8c33f900342705ad06a3127/6255c/step-one.png 590w,
/static/fc859eb2a8c33f900342705ad06a3127/dcf9c/step-one.png 885w,
/static/fc859eb2a8c33f900342705ad06a3127/43c8a/step-one.png 1180w,
/static/fc859eb2a8c33f900342705ad06a3127/dc8c4/step-one.png 1770w,
/static/fc859eb2a8c33f900342705ad06a3127/f70b8/step-one.png 2032w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p><a href="/labs/getting-started-with-flux/step-one/" target="_blank">You can view this in your browser here</a> - we’re going to build on top of this, using Flux to keep our model and view in sync.</p>
<h3>Views</h3>
<p>We’ve got two main views, named <code class="language-text">UserList</code> and <code class="language-text">MessageBox</code>. Not only does the main message box need to display the chat for which user is selected in the list, they both rely on the same data in order to display the messages, and one view becoming out of sync with the other could become disastrous. This is where the magic of Flux comes in!</p>
<h3>Dispatcher, come in</h3>
<p>As mentioned earlier, every application needs one dispatcher - let’s go ahead and create it. The app has a folder inside <code class="language-text">public/src/js/</code> called <code class="language-text">dispatchers</code> - we’re going to create a new file inside this directory called <code class="language-text">app.js</code>. As we’re using browserify we can require the flux npm module straight into our code.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> assign <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'object-assign'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> appDispatcher <span class="token operator">=</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">handleServerAction</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      source<span class="token punctuation">:</span> <span class="token string">'server'</span><span class="token punctuation">,</span>
      action<span class="token punctuation">:</span> action
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">handleViewAction</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      source<span class="token punctuation">:</span> <span class="token string">'view'</span><span class="token punctuation">,</span>
      action<span class="token punctuation">:</span> action
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> appDispatcher<span class="token punctuation">;</span></code></pre></div>
<p>We’ve now created the dispatcher, and added two action types to it. This allows us to receive actions from both the view (the user accessing the application) and the server (more on that soon). You’ll notice in both methods we are calling <code class="language-text">this.dispatch</code> - this dispatches the given payload (containing <code class="language-text">source</code> and <code class="language-text">action</code>) to anyone who is watching!.</p>
<h3>Store our messages</h3>
<p>Our views need somewhere to get their data from, so let’s create a store for our messages. The boilerplate has a folder in <code class="language-text">public/src/js</code> called <code class="language-text">stores</code>, which already contains <code class="language-text">user.js</code> (just a basic store of information, this would typically be received via a server), so we’ll go ahead and create a file called <code class="language-text">messages.js</code>.</p>
<p>For now, we’re going to be using static default data. Typically this would come from the server beforehand, but we haven’t integrated ours with a server (yet..).</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>EventEmitter<span class="token punctuation">;</span>
<span class="token keyword">var</span> assign <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'object-assign'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> messages <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">2</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      profilePicture<span class="token punctuation">:</span> <span class="token string">'https://avatars0.githubusercontent.com/u/7922109?v=3&amp;s=460'</span><span class="token punctuation">,</span>
      id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'Ryan Clark'</span><span class="token punctuation">,</span>
      status<span class="token punctuation">:</span> <span class="token string">'online'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    lastAccess<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      recipient<span class="token punctuation">:</span> <span class="token number">1424469794050</span><span class="token punctuation">,</span>
      currentUser<span class="token punctuation">:</span> <span class="token number">1424469794080</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    messages<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        contents<span class="token punctuation">:</span> <span class="token string">'Hey!'</span><span class="token punctuation">,</span>
        <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        timestamp<span class="token punctuation">:</span> <span class="token number">1424469793023</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        contents<span class="token punctuation">:</span> <span class="token string">'Hey, what\'s up?'</span><span class="token punctuation">,</span>
        <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        timestamp<span class="token punctuation">:</span> <span class="token number">1424469794000</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> openChatID <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> messagesStore <span class="token operator">=</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">addChangeListener</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">removeChangeListener</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getOpenChatUserID</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> openChatID<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getChatByUserID</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> messages<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getAll</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> messages<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

messagesStore<span class="token punctuation">.</span>dispatchToken <span class="token operator">=</span> Dispatcher<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h5>Payload Explanation</h5>
<p>We’re using an object for our messages, with the user’s ID as the key, and various data about the user in value. If you open up both <code class="language-text">messageBox.jsx</code> and <code class="language-text">userList.jsx</code> in <code class="language-text">public/src/js/partials/</code>, you’ll notice the static data in the store is pretty much exactly the same as what we’re already rendering our React view with. This means that it is going to be super easy to get our view hooked up to the store.</p>
<p>If you’re wondering what <code class="language-text">lastAccess</code> is, it basically has two values, one for the current user who is accessing the application and one for the other user. They’re UNIX timestamps of when they last accessed the chat, so we can tell if the messsages are either unread or read.</p>
<p>We’ve also got <code class="language-text">openChatID</code> - this is the value of the first key of our messages (the first user ID), so the first chat is open by default.</p>
<h5>Store Explanation</h5>
<p>To create our store, we’re extending upon a default node module called <code class="language-text">events</code>. As mentioned above, we’re using browserify so we can just include this right in. This allows us to quickly make objects that let us register and unregister callbacks, as well as emit events.</p>
<p>I’ve added on both <code class="language-text">addChangeListener</code> and <code class="language-text">removeChangeListener</code> to our store - this is just a more verbose method of <code class="language-text">on</code> and <code class="language-text">off</code>, so you can tell exactly what it’s doing. I’ve also added two methods to retrieve message data, either all of it or by user ID. We can use these two functions in both of our views, to get the relevant data we need.</p>
<p>There’s also the store’s <code class="language-text">dispatchToken</code> - this is all the events that it listens to from our dispatcher. At the moment we’re not concerned about any events, so it is just a blank object.</p>
<h3>Hook it all up</h3>
<p>Now we can make our views get their data from the same place, our store. If we go into our <code class="language-text">MessageBox</code> view in <code class="language-text">public/src/js/partials</code>, you can see that we’re setting the state to contain the message data for the currently open chat. As this is in our store, accessible via <code class="language-text">getChatByUserID</code> (and to get the current user ID, <code class="language-text">getOpenChatUserID</code>), we can remove it and replace it with calls to our store.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">var</span> UserStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> MessageBox <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      user<span class="token punctuation">:</span> <span class="token operator">...</span><span class="token punctuation">,</span>
      lastAccess<span class="token punctuation">:</span> <span class="token operator">...</span><span class="token punctuation">,</span>
      messages<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ommited logic</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-box__list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span> messages <span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ReplyBox</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MessageBox<span class="token punctuation">;</span></code></pre></div>
<p>Will become -</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">var</span> MessagesStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/messages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> UserStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> MessageBox <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> MessagesStore<span class="token punctuation">.</span><span class="token function">getChatByUserID</span><span class="token punctuation">(</span>MessagesStore<span class="token punctuation">.</span><span class="token function">getOpenChatUserID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ommited logic</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message-box__list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span> messages <span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ReplyBox</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MessageBox<span class="token punctuation">;</span></code></pre></div>
<p>Once you’ve made that change, look at your localhost - it looks exactly the same! Perhaps the only time you should be happy that a major code change produced no visual change in your UI, but nonetheless we’re one step closer!</p>
<p>Now we can do the same to our <code class="language-text">UserList</code>. This will require a bit of pre-processing our stored data, as we’re only interested in the last message sent. If we open up <code class="language-text">userList.jsx</code> in <code class="language-text">public/src/js/partials</code>, we will see what data we’re using -</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">var</span> UserStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> UserList <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      openChatID<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      messageList<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          lastMessage<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            contents<span class="token punctuation">:</span> <span class="token string">'Hey, what\'s up?'</span><span class="token punctuation">,</span>
            <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            timestamp<span class="token punctuation">:</span> <span class="token number">1424469794000</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          lastAccess<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            recipient<span class="token punctuation">:</span> <span class="token number">1424469794050</span><span class="token punctuation">,</span>
            currentUser<span class="token punctuation">:</span> <span class="token number">1424469794080</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          user<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            profilePicture<span class="token punctuation">:</span> <span class="token string">'https://avatars0.githubusercontent.com/u/7922109?v=3&amp;s=460'</span><span class="token punctuation">,</span>
            id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            name<span class="token punctuation">:</span> <span class="token string">'Ryan Clark'</span><span class="token punctuation">,</span>
            status<span class="token punctuation">:</span> <span class="token string">'online'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// omitted logic</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user-list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user-list__list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span> messages <span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> UserList<span class="token punctuation">;</span></code></pre></div>
<p>As the data we need isn’t that far away from our stored data, processing it to what we need will be relatively easy.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">var</span> MessagesStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/messages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> UserStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> UserList <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> allMessages <span class="token operator">=</span> MessagesStore<span class="token punctuation">.</span><span class="token function">getAllChats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> messageList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> id <span class="token keyword">in</span> allMessages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> item <span class="token operator">=</span> allMessages<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">var</span> messagesLength <span class="token operator">=</span> item<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      messageList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        lastMessage<span class="token punctuation">:</span> item<span class="token punctuation">.</span>messages<span class="token punctuation">[</span>messagesLength <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        lastAccess<span class="token punctuation">:</span> item<span class="token punctuation">.</span>lastAccess<span class="token punctuation">,</span>
        user<span class="token punctuation">:</span> item<span class="token punctuation">.</span>user
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      openChatID<span class="token punctuation">:</span> MessagesStore<span class="token punctuation">.</span><span class="token function">getOpenChatUserID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      messageList<span class="token punctuation">:</span> messageList
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// omitted logic</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user-list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user-list__list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span> messages <span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> UserList<span class="token punctuation">;</span></code></pre></div>
<p>How simple was that!? And we still get exactly the same results as we did before we changed, but it comes from a single source now!</p>
<p><a href="/labs/getting-started-with-flux/step-two/" target="_blank">You can this out so far here</a> - I’ve omitted the screenshot as nothing has changed but our underlying code. You can also check out all the code by checking out the <code class="language-text">step-two</code> branch on our boilerplate.</p>
<h3>Get some blood (events) flowing</h3>
<p>The next step is to get some events flowing around our app. Let’s get it so we can swap between our chats by clicking on different users on the <code class="language-text">UserList</code>.</p>
<h4>Our first Action</h4>
<p>Actions can come from anywhere, all we need to know is that they affect something and we need to funnel them through our dispatcher and out into our stores. We’ll create an action when the user clicks on a user, and dispatch the event.</p>
<p>In <code class="language-text">public/src/js</code> there is a folder called <code class="language-text">actions</code> - let’s create a file called <code class="language-text">messages.js</code> -</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> messagesActions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">changeOpenChat</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newUserID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Dispatcher<span class="token punctuation">.</span><span class="token function">handleViewAction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">'updateOpenChatID'</span><span class="token punctuation">,</span>
      userID<span class="token punctuation">:</span> newUserID
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> messagesActions<span class="token punctuation">;</span></code></pre></div>
<p>Actions are nothing special. No npm module or other dependency is needed, all we need is our already created dispatcher. We can now call <code class="language-text">changeOpenChat</code> with an ID, and it will dispatch an action to our stores. But wait - our stores need to listen to them!</p>
<h4>Watching for an event in a store</h4>
<p>We’re going to open up our <code class="language-text">MessagesStore</code> again, and have a look at our <code class="language-text">dispatchToken</code>. This function is invoked whenever the dispatcher receives an action to dispatch. We can then check if the payload dispatched concerns us, and do some fancy stuff if it does.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">  <span class="token keyword">var</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">updateOpenChatID</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  actions<span class="token punctuation">[</span>payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> actions<span class="token punctuation">[</span>payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>I’ve added an object with the key being the <code class="language-text">type</code> property value of the event we dispatched in our actions. The function checks to see if there is a property that matches the type it’s given, and invokes it if it is. Within this function we can now update our store values, and notify our views that something has changed.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">  <span class="token keyword">var</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">updateOpenChatID</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      openChatID <span class="token operator">=</span> payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>userID<span class="token punctuation">;</span>

      messagesStore<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  actions<span class="token punctuation">[</span>payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> actions<span class="token punctuation">[</span>payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>We’ve now updated our <code class="language-text">openChatID</code> variable with the new ID, and then we’ve emitted a change on our store. (Note: the <code class="language-text">emit</code> method is given to us by <code class="language-text">EventEmitter</code>).</p>
<p>That’s great, but our views won’t have a clue anything has been updated, as they haven’t subscribed to any events.</p>
<h4>Views, listen up</h4>
<p>We’re going to add a listener to our view, and update the state whenever we get a notification that something has changed. If we open up <code class="language-text">MessageBox</code>, we can add a <code class="language-text">componentWillMount</code> and <code class="language-text">componentWillUnmount</code> method to them. This is so we can add the event whenever the view is created, and if for some reason it’s deleted, remove the event so we don’t get any future errors.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> MessagesStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/messages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> UserStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getStateFromStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> MessagesStore<span class="token punctuation">.</span><span class="token function">getChatByUserID</span><span class="token punctuation">(</span>MessagesStore<span class="token punctuation">.</span><span class="token function">getOpenChatUserID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> MessageBox <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getStateFromStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">componentWillMount</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MessagesStore<span class="token punctuation">.</span><span class="token function">addChangeListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onStoreChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">componentWillUnmount</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MessagesStore<span class="token punctuation">.</span><span class="token function">removeChangeListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onStoreChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onStoreChange</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token function">getStateFromStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// omitted logic</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MessageBox<span class="token punctuation">;</span></code></pre></div>
<p>You’ll notice we’ve got a new function <code class="language-text">getStateFromStore</code> - I’ve abstracted the call to get the state so we can reuse it multiple times. That way, if we ever need to change how we get our state, we won’t have to make the change in multiple places.</p>
<p>When the component mounts, we’ve added a change listener, which will fire off the <code class="language-text">onStoreChange</code> method, updating our view to the latest data in the store. When the component unmounts, we clean up after ourselves and remove the listener.</p>
<h5>And again…</h5>
<p>Now we need to do the same to the <code class="language-text">UserList</code>. We could just update the state manually for the <code class="language-text">UserList</code> view, however the best practise is to rely on the data from the store, as it will be the same for all of our views that request it.</p>
<p>Let’s open up <code class="language-text">UserList</code>, abstract the state retrieval and add our listeners.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> MessagesStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/messages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> UserStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> UserList <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> allMessages <span class="token operator">=</span> MessagesStore<span class="token punctuation">.</span><span class="token function">getAllChats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> messageList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> id <span class="token keyword">in</span> allMessages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> item <span class="token operator">=</span> allMessages<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">var</span> messagesLength <span class="token operator">=</span> item<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      messageList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        lastMessage<span class="token punctuation">:</span> item<span class="token punctuation">.</span>messages<span class="token punctuation">[</span>messagesLength <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        lastAccess<span class="token punctuation">:</span> item<span class="token punctuation">.</span>lastAccess<span class="token punctuation">,</span>
        user<span class="token punctuation">:</span> item<span class="token punctuation">.</span>user
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      openChatID<span class="token punctuation">:</span> MessagesStore<span class="token punctuation">.</span><span class="token function">getOpenChatUserID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      messageList<span class="token punctuation">:</span> messageList
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// omitted logic</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> UserList<span class="token punctuation">;</span></code></pre></div>
<p>Will become -</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> MessagesStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/messages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> UserStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getStateFromStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> allMessages <span class="token operator">=</span> MessagesStore<span class="token punctuation">.</span><span class="token function">getAllChats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> messageList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> id <span class="token keyword">in</span> allMessages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> item <span class="token operator">=</span> allMessages<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> messagesLength <span class="token operator">=</span> item<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    messageList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      lastMessage<span class="token punctuation">:</span> item<span class="token punctuation">.</span>messages<span class="token punctuation">[</span>messagesLength <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      lastAccess<span class="token punctuation">:</span> item<span class="token punctuation">.</span>lastAccess<span class="token punctuation">,</span>
      user<span class="token punctuation">:</span> item<span class="token punctuation">.</span>user
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    openChatID<span class="token punctuation">:</span> MessagesStore<span class="token punctuation">.</span><span class="token function">getOpenChatUserID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    messageList<span class="token punctuation">:</span> messageList
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> UserList <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getStateFromStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">componentWillMount</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MessagesStore<span class="token punctuation">.</span><span class="token function">addChangeListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onStoreChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">componentWillUnmount</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MessagesStore<span class="token punctuation">.</span><span class="token function">removeChangeListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onStoreChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onStoreChange</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token function">getStateFromStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// omitted logic</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> UserList<span class="token punctuation">;</span></code></pre></div>
<p>Sorted! Our <code class="language-text">UserList</code> will now listen for events too.</p>
<h4>Firing off the event</h4>
<p>Now we’ve got our view ready to listen to the event, we need to actually set it off. We will do this in the <code class="language-text">UserList</code> view when the user clicks on a different user. To start off, we’re going to open up <code class="language-text">UserList</code> and add an onClick listener.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">var</span> MessagesStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/messages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> UserStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> UserList <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token function-variable function">changeOpenChat</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// omitted logic</span>

    <span class="token keyword">var</span> messages <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>messageList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// omitted logic</span>

      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeOpenChat</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> itemClasses <span class="token punctuation">}</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> message<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id <span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user-list__item__picture<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> message<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profilePicture <span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user-list__item__details<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user-list__item__name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
              </span><span class="token punctuation">{</span> message<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token plain-text">

              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>abbr</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user-list__item__timestamp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span> date <span class="token punctuation">}</span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>abbr</span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user-list__item__message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
              </span><span class="token punctuation">{</span> statusIcon <span class="token punctuation">}</span><span class="token plain-text"> </span><span class="token punctuation">{</span> message<span class="token punctuation">.</span>lastMessage<span class="token punctuation">.</span>contents <span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// omitted logic</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> UserList<span class="token punctuation">;</span></code></pre></div>
<p>We’ve now got an <code class="language-text">onClick</code> event that will call our method <code class="language-text">changeOpenChat</code> with the user ID of whoever the user clicked. We can now invoke the action that we created earlier.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> MessagesStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/messages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> UserStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> MessagesActions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../actions/messages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> UserList <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token function-variable function">changeOpenChat</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MessagesActions<span class="token punctuation">.</span><span class="token function">changeOpenChat</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// omitted logic</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> UserList<span class="token punctuation">;</span></code></pre></div>
<p>Pretty nice, eh? We’ve set it up so all we need to do is call an action we defined with an ID, that takes care of sending off the event to the dispatcher, that our stores then listen to, then notify the view that they’ve updated! And it really is as simple as that. If you click on a different user, you can now see their messages -</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/3ef22d2338398151ff6b8225a5358689/f70b8/step-three.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 57.332677165354326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABLUlEQVQoz7WRy0rDQBSG5xnFrfgerS1U9AXUqjtFcGPVgm6CFKul0ICx3UiNJhlCLm2SEhHMZZJJcpykLuwuAf2Hb+Awh485HHQ75Ne4yfSu/4IvR8qsy+N5wUielcTs8sr8aiiqXIfj1tHWzdP2EU5hb+pB+53AvujDwVsIx0pcmkOJwIkF0LoXd1Hv+qJmqBhcd0GI71EaBkkakQQAykIZEQM+3UUDnZ43673XM+hM2nSsPWb5Q8ZOmpUmY+RisCy7iVRVrhf2rw8aEG8pZI0VYHfxU7BtJjQMsxCSkFBKkxVhmSx9v4S6rhfCIAhoHMf/Kyw78opQ07RaXvi+T5iw2BzrqUr0I2wg0zRb8EdxHGcHCYKwoSjKWJblviRJgxxWDzDGVXhgPLNsfgM2Gi169oLVEQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Step Three"
        title=""
        src="/static/3ef22d2338398151ff6b8225a5358689/6255c/step-three.png"
        srcset="/static/3ef22d2338398151ff6b8225a5358689/375dc/step-three.png 148w,
/static/3ef22d2338398151ff6b8225a5358689/6b157/step-three.png 295w,
/static/3ef22d2338398151ff6b8225a5358689/6255c/step-three.png 590w,
/static/3ef22d2338398151ff6b8225a5358689/dcf9c/step-three.png 885w,
/static/3ef22d2338398151ff6b8225a5358689/43c8a/step-three.png 1180w,
/static/3ef22d2338398151ff6b8225a5358689/dc8c4/step-three.png 1770w,
/static/3ef22d2338398151ff6b8225a5358689/f70b8/step-three.png 2032w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p><a href="/labs/getting-started-with-flux/step-three/" target="_blank">You can play around with this here.</a> You can also checkout the <code class="language-text">step-three</code> branch on the boilerplate if you wish to see all the code!</p>
<h3>Send a message</h3>
<p>The next logical step is that we need to be able to send some messages! You’re going to love how simple this is going to be. First of all, we need to create an event on our input box for when the user presses enter. Let’s go!</p>
<h4>Create the event</h4>
<p>We’ve got a component called <code class="language-text">ReplyBox</code> in <code class="language-text">public/src/js/components</code>. Open it up - you’ll find a bare boned React component in there. First of all, we need to keep track of the input’s value in the components state. Let’s add an <code class="language-text">onChange</code> event to our input. As we’re also tracking state in this component, we will need to add a <code class="language-text">getInitialState</code> method to return our initial state.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function-variable function">getInitialState</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">updateValue</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reply-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>updateValue <span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reply-box__input<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Type message to reply..<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reply-box__tip<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          Press </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reply-box__tip__button<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Enter</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text"> to send
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> ReplyBox<span class="token punctuation">;</span></code></pre></div>
<p>React passes through an event to your functions when they’re called from user input. We can access what the user is typing by looking at <code class="language-text">e.target.value</code>. Then all we need to do is set the state to this, set the input’s value to the state, and we’re sorted! <a href="http://facebook.github.io/react/docs/events.html" target="_blank">Read more about React events here</a>.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">  <span class="token function-variable function">getInitialState</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">updateValue</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reply-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value <span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>updateValue <span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reply-box__input<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Type message to reply..<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reply-box__tip<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          Press </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reply-box__tip__button<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Enter</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text"> to send
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> ReplyBox<span class="token punctuation">;</span></code></pre></div>
<p>Beautiful! Now we can access whatever has been typed in the reply box in the <code class="language-text">state</code> object of the component. If we add an <code class="language-text">onKeyDown</code> event to the input also, we can now check the <code class="language-text">keyCode</code> of the event. If it is 13 (the Javascript key code for enter), we can submit and clear out the value of the input.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">var</span> MessagesStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../stores/messages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> ReplyBox <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">handleKeyDown</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      MessagesActions<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>MessagesStore<span class="token punctuation">.</span><span class="token function">getOpenChatUserID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token string">''</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">updateValue</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reply-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value <span class="token punctuation">}</span></span> <span class="token attr-name">onKeyDown</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleKeyDown <span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>updateValue <span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reply-box__input<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Type message to reply..<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reply-box__tip<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          Press </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reply-box__tip__button<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Enter</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text"> to send
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> ReplyBox<span class="token punctuation">;</span></code></pre></div>
<p>We’ve added a check for that key code, and if it is enter, we’re calling <code class="language-text">sendMessages</code> in <code class="language-text">MessagesActions</code> with the value of the message we want to send. But wait, that action doesn’t exist yet!?</p>
<h4>Create the action</h4>
<p>Let’s add a new action to our <code class="language-text">MessagesActions</code> object. This will accept message text and the user ID that we are sending a message to. It will then dispatch an event for the stores to listen to. Normally, this would be the point where you’d contact the server with the message, and then dispatch the event once the server has responded that it’s all okay.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> messagesActions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">changeOpenChat</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newUserID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Dispatcher<span class="token punctuation">.</span><span class="token function">handleViewAction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">'updateOpenChatID'</span><span class="token punctuation">,</span>
      userID<span class="token punctuation">:</span> newUserID
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">sendMessage</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">userID<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Dispatcher<span class="token punctuation">.</span><span class="token function">handleViewAction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">'sendMessage'</span><span class="token punctuation">,</span>
      userID<span class="token punctuation">:</span> userID<span class="token punctuation">,</span>
      message<span class="token punctuation">:</span> message<span class="token punctuation">,</span>
      timestamp<span class="token punctuation">:</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> messagesActions<span class="token punctuation">;</span></code></pre></div>
<p>Now we’ve made the action, we can type in the reply box and press enter and check that it empties. The store isn’t watching for the event just yet, so it will just clear out the input and do nothing after. Let’s set the store up to watch for a new message.</p>
<h4>Create the store watcher</h4>
<p>Heading back to our <code class="language-text">dispatchToken</code> in our <code class="language-text">MessagesStore</code>, we can now add another item to our object - <code class="language-text">sendMessage</code>. We get the user ID to send to, the timestamp it was sent and the contents of the message.</p>
<p>Let’s look up the user who we’ve sent a message to in our <code class="language-text">messages</code> object, and push a new message into their messages array.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">  <span class="token keyword">var</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">updateOpenChatID</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      openChatID <span class="token operator">=</span> payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>userID<span class="token punctuation">;</span>

      messagesStore<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">sendMessage</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> userID <span class="token operator">=</span> payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>userID<span class="token punctuation">;</span>

      messages<span class="token punctuation">[</span>userID<span class="token punctuation">]</span><span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        contents<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
        timestamp<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span>
        <span class="token keyword">from</span><span class="token punctuation">:</span> UserStore<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      messagesStore<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  actions<span class="token punctuation">[</span>payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> actions<span class="token punctuation">[</span>payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Sorted. If you look at localhost now, you can type in the reply box, press enter and the message appears not only in the <code class="language-text">MessageBox</code> view, but also in the <code class="language-text">UserList</code> view as the last sent message.</p>
<p>If you send a message to myself, you’ll also notice the “Read” message disappears - that’s because we’re keeping track of the last time I accessed the chat (via <code class="language-text">lastAccess</code>), and I haven’t accessed it since you’ve sent me a message!</p>
<p>Also, if you send a message to either Todd or Jilles, they’ll move to the top of the list, as they’re ordered by when the last message was sent!</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/09c02f0e378fba9c8ef91382707633a0/f70b8/step-four.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 57.332677165354326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABMElEQVQoz62Rv0vDQBTH719Uuoo4ujm3tGrV3d3VoYPSpUONg2mCFREziBUJza8jaX4h1UDjXX4972JAhIIJ+LjPu+X7Przj0OjhafNqZgny/O3iDi+HE9MdSgzRWDTAvbxWzfG5MG6hjcGgv/P6DK17EXZf5nBgJbBvUejbWW2OcAKnEcDerXqCxNFZW8MyzBYy8ZZqCpRmkDAA6pIGMaVCEAN2vS6aTqadj3cKUZSmlOQFCwBveVHUgp/PLM8Im3E8r4cwtjpcsopXKU3ot7AM1qaoNoUgCHrIcZxSSClJWf0S/lVVhvdS6Pv+j5CQ5sIqu37DdcKmTy43tG27XQm5sfw5lmkKrYRd5LruIfxThWF4jBRF2dJ1XWHcaJomcQzDkEzTLO+aiGz+kbm2vwD+bC0xDsMW5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Step Four"
        title=""
        src="/static/09c02f0e378fba9c8ef91382707633a0/6255c/step-four.png"
        srcset="/static/09c02f0e378fba9c8ef91382707633a0/375dc/step-four.png 148w,
/static/09c02f0e378fba9c8ef91382707633a0/6b157/step-four.png 295w,
/static/09c02f0e378fba9c8ef91382707633a0/6255c/step-four.png 590w,
/static/09c02f0e378fba9c8ef91382707633a0/dcf9c/step-four.png 885w,
/static/09c02f0e378fba9c8ef91382707633a0/43c8a/step-four.png 1180w,
/static/09c02f0e378fba9c8ef91382707633a0/dc8c4/step-four.png 1770w,
/static/09c02f0e378fba9c8ef91382707633a0/f70b8/step-four.png 2032w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p><a href="/labs/getting-started-with-flux/step-four/" target="_blank">Send some imaginary people messages here</a>, or you can checkout the <code class="language-text">step-four</code> branch to see the code!</p>
<h4>Updating our last access</h4>
<p>We haven’t got any method to update our <code class="language-text">lastAccess</code> status, meaning that any messages you sent will have a circle next to them on the <code class="language-text">UserList</code> view.</p>
<p>In our store, we can simply update this when the user triggers a method.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">  <span class="token keyword">var</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">updateOpenChatID</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      openChatID <span class="token operator">=</span> payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>userID<span class="token punctuation">;</span>
      messages<span class="token punctuation">[</span>openChatID<span class="token punctuation">]</span><span class="token punctuation">.</span>lastAccess<span class="token punctuation">.</span>currentUser <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      messagesStore<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">sendMessage</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> userID <span class="token operator">=</span> payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>userID<span class="token punctuation">;</span>

      messages<span class="token punctuation">[</span>userID<span class="token punctuation">]</span><span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        contents<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
        timestamp<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span>
        <span class="token keyword">from</span><span class="token punctuation">:</span> UserStore<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      messages<span class="token punctuation">[</span>userID<span class="token punctuation">]</span><span class="token punctuation">.</span>lastAccess<span class="token punctuation">.</span>currentUser <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      messagesStore<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  actions<span class="token punctuation">[</span>payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> actions<span class="token punctuation">[</span>payload<span class="token punctuation">.</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>We’ve added calls to update the <code class="language-text">lastAccess</code> value on both <code class="language-text">updateOpenChatID</code> (as the user has just opened the chat) and <code class="language-text">sendMessage</code> (as the user has just sent the message).</p>
<p>Now, when you click on a user with an unread message (such as Todd), it will mark it as read! Or if you reply to Jilles, you will get the neat reply icon in the <code class="language-text">UserList</code> view.</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/7906a1047b32ddc8ebf529e82f4495c1/f70b8/step-five-one.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 57.52952755905512%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABI0lEQVQoz9WOu07DMBSG/TC8CK/RCImJy4DEK+QFKgTKfWWAhg4sTEWIDCwNESUJJYoSQNzKSogTx60PdmCoBENSJn7pk21Z/3cOGlwFJ+d+dDhMn2zv7tX27if16aYv9mUD3PSZd956F2F0vN8/WkZqArA3noEaA3THOXRvcti5LWA3rjikGVEJ6gPAds/ZQmfeAThJv7x+dCjOMf3I3ikpCwoAbag4EIbBGholAximpzSejBjMhTHWFJGZ6Pi+v4HEZUqAMlr/wQL8FOY4pyUp2fxmTfOrEGNMCSH/QPiHTL+F67WwKIqKUiqmLEotDILgS5hlmZAC3xKqqgIub4Xoibiuu4lM01w1DKOj67qkKIqkaZrE363g3Y5lWSuyLC99AsSJaNHLDYL9AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Step Five, Part One"
        title=""
        src="/static/7906a1047b32ddc8ebf529e82f4495c1/6255c/step-five-one.png"
        srcset="/static/7906a1047b32ddc8ebf529e82f4495c1/375dc/step-five-one.png 148w,
/static/7906a1047b32ddc8ebf529e82f4495c1/6b157/step-five-one.png 295w,
/static/7906a1047b32ddc8ebf529e82f4495c1/6255c/step-five-one.png 590w,
/static/7906a1047b32ddc8ebf529e82f4495c1/dcf9c/step-five-one.png 885w,
/static/7906a1047b32ddc8ebf529e82f4495c1/43c8a/step-five-one.png 1180w,
/static/7906a1047b32ddc8ebf529e82f4495c1/dc8c4/step-five-one.png 1770w,
/static/7906a1047b32ddc8ebf529e82f4495c1/f70b8/step-five-one.png 2032w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/9f0ebbdcfd16cc716d255d940559f221/f70b8/step-five-two.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 57.52952755905512%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABSElEQVQoz72Qy0rDQBSG8zC+iK/RILgQLwtF8An6AgqF0LRB3Ihgo6AIblwIKgXbRJEktlTtxdpWFIptmplmJpljxqZQ3TRR8Idvbpz5OBwhbzVO9cr7vtXsqXqto97UO6pebU9FC/fiU0stVDu5S6N8vHt4MCusFYqwcH4GG9e3sFVCsFlyIFVxIfUQgaBOeiSwXfdgpwWwnrtYFfTyEeRrJ0Pz5Yoix6HOYEABIDJdROjeXZPkWz24t6xFof38Bh/dIcWOxyAMYywSPMTz2auNfRycDcNYFvhzr9+nCCMWVfRDyhcfxkJ+wBhTQlw22d20jGvYKN+FCCHquvGEE+J/FP4hXihcGs+QUEr9cLi/4UtomuZIaNs2l0LQJRBCIJDHgv/j0TRtRchms/OZTCYhy7IoSZKYTqfF4B6L4G9CUZS5ZDI58wlYkGe/coOrCgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="Step Five, Part Two"
        title=""
        src="/static/9f0ebbdcfd16cc716d255d940559f221/6255c/step-five-two.png"
        srcset="/static/9f0ebbdcfd16cc716d255d940559f221/375dc/step-five-two.png 148w,
/static/9f0ebbdcfd16cc716d255d940559f221/6b157/step-five-two.png 295w,
/static/9f0ebbdcfd16cc716d255d940559f221/6255c/step-five-two.png 590w,
/static/9f0ebbdcfd16cc716d255d940559f221/dcf9c/step-five-two.png 885w,
/static/9f0ebbdcfd16cc716d255d940559f221/43c8a/step-five-two.png 1180w,
/static/9f0ebbdcfd16cc716d255d940559f221/dc8c4/step-five-two.png 1770w,
/static/9f0ebbdcfd16cc716d255d940559f221/f70b8/step-five-two.png 2032w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p><a href="/labs/getting-started-with-flux/step-five/" target="_blank">Play around with the finished chat application here</a>, or you can checkout the <code class="language-text">step-five</code> branch to see the code!</p>
<h3>waitFor</h3>
<p>Flux also offers you the ability to wait for other stores to finish processing their data before executing the <code class="language-text">dispatchToken</code> on your store. To do this, at the beginning of your store, just call the dispatchers <code class="language-text">waitFor</code> function at the beginning of your <code class="language-text">dispatchToken</code> function, passing through an array of stores that you wish to wait for.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">Store<span class="token punctuation">.</span>dispatchToken <span class="token operator">=</span> Dispatcher<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Dispatcher<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    OtherStore<span class="token punctuation">.</span>dispatchToken<span class="token punctuation">,</span>
    AndAnotherStore<span class="token punctuation">.</span>dispatchToken
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>Conclusion</h2>
<p>In conclusion, although Flux seems scary to get started with, it is in fact ridiculously simple and quick to develop with. Just follow the steps above when using it in your applications! If you need any help, feel free to reach out to me on twitter - <a href="http://twitter.com/rynclark" target="_blank">@rynclark</a>. I’ll be looking into integrating this with node.js and socket.io in the future, so stay tuned.</p></div><hr style="margin-bottom:1.625rem"/><div style="display:flex;align-items:center;margin-bottom:4.0625rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.8125rem;margin-bottom:0;min-width:50px;border-radius:100%"><img src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAMEBQL/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABuwWITXBl8FmuJf/EABsQAAICAwEAAAAAAAAAAAAAAAECAwQAETIQ/9oACAEBAAEFArp0sUTeXRtISqpl/gc5/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAx/9oACAEDAQE/ASGz/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAx/9oACAECAQE/ATEYv//EABoQAAIDAQEAAAAAAAAAAAAAAAACARARYXH/2gAIAQEABj8CU1spdk7S+kV//8QAGxABAAICAwAAAAAAAAAAAAAAAQAREDEhUWH/2gAIAQEAAT8hBT2xgVPDAcALg1As1jZkGkx//9oADAMBAAIAAwAAABDTwDz/xAAXEQADAQAAAAAAAAAAAAAAAAABEBEx/9oACAEDAQE/EJpq0X//xAAWEQEBAQAAAAAAAAAAAAAAAAAQMRH/2gAIAQIBAT8Q1BA//8QAHRAAAgIDAAMAAAAAAAAAAAAAAREhMQAQYUFRkf/aAAgBAQABPxDgJD3GKGGCCONModqyVCCnFgwuXPnk6gFYYfMbgJp9nX//2Q==" alt="Ryan Clark" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition:opacity 0.5s;transition-delay:0.25s;border-radius:50%"/><noscript><picture><img width="50" height="50" srcset="/static/89447586dcc046565cd42084cb1753e2/7e494/profile-pic.jpg 1x,
/static/89447586dcc046565cd42084cb1753e2/36cc2/profile-pic.jpg 1.5x,
/static/89447586dcc046565cd42084cb1753e2/0a3a6/profile-pic.jpg 2x,
/static/89447586dcc046565cd42084cb1753e2/75d16/profile-pic.jpg 3x" src="/static/89447586dcc046565cd42084cb1753e2/7e494/profile-pic.jpg" alt="Ryan Clark" style="position:absolute;top:0;left:0;transition:opacity 0.5s;transition-delay:0.5s;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div>A blog by me, <strong>Ryan Clark</strong>. <a target="_blank" href="https://twitter.com/rynclark">Follow me on Twitter!</a></div></div><div id="disqus_thread"></div></main></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-49723822-1', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-tsx","jsonName":"getting-started-with-flux-896","path":"/getting-started-with-flux/"};window.dataPath="929/path---getting-started-with-flux-896-542-Nvj4997rMy2eGWfljaABEfppz9E";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-6cffb0c4ad93a48e7404.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-4ce7f49cec02d9b9d831.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx-55170dfe89bf8d80733f.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-69e227989c0bb89889a2.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-cf377fd6b737b1ec4eee.js"],"pages-manifest":["/pages-manifest-7ac2230e2b75e7cea941.js"]};/*]]>*/</script><script src="/webpack-runtime-89ac9663dc7ab56cdd13.js" async=""></script><script src="/styles-99a47daf12289a4bd376.js" async=""></script><script src="/app-6cffb0c4ad93a48e7404.js" async=""></script><script src="/0-598e12153a4b2f19d440.js" async=""></script><script src="/9-0c2af406927ebc328aa0.js" async=""></script><script src="/component---src-templates-blog-post-tsx-55170dfe89bf8d80733f.js" async=""></script></body></html>